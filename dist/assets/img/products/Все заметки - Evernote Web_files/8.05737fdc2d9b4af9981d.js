(window.webpackJsonp=window.webpackJsonp||[]).push([[8,5],{3120:function(e,t,n){"use strict";n.r(t);var r=n(66),o=n(441),i=n(61),u=n(22);function a(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){a(i,r,o,u,c,"next",e)}function c(e){a(i,r,o,u,c,"throw",e)}u(void 0)})}}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}var l=Object(u.default)("ion:sugar:lib:DataSource"),p=!1,d=[],b=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=void 0,this.tableName=void 0,this.persistState=void 0,this.state=void 0,this.namespace=void 0,this.dataSourceReady=void 0,this.dataSourceInitialized=void 0,this.resolveReady=void 0,this.resolveInit=void 0,this.unsubscribeFns=void 0,this.name=n,this.tableName=r,this.persistState=o,this.setState(t,!0),this.unsubscribeFns=[],this.initPromises(),d.push(this)}return f(e,null,[{key:"getInstances",value:function(){return d}},{key:"reset",value:function(){p=!1}}]),f(e,[{key:"initPromises",value:function(){var e=this;this.dataSourceReady=new Promise(function(t){e.resolveReady=function(){t()}}),this.dataSourceInitialized=new Promise(function(t){e.resolveInit=t})}},{key:"subscribe",value:function(){throw new Error("must override subscribe")}},{key:"unsubscribe",value:function(){this.unsubscribeFns&&this.unsubscribeFns.length&&(this.unsubscribeFns.forEach(function(e){return e(!0)}),this.unsubscribeFns=[])}},{key:"init",value:function(e){var t=this;return new Promise(function(n){if(t.setState(t.initialState,!0),t.namespace=e,!1===t.persistState)return n();t.loadState().then(function(){return n()})}).then(this.subscribe).then(this.resolveInit)}},{key:"deInit",value:function(){var e=c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataSourceInitialized;case 2:this.unsubscribe(),this.initPromises(),this.setState(this.initialState,!0),this.unpublish();case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e,t){Object.freeze(e),this.state=e,this.publish(),!t&&this.persistState&&p&&this.saveState(e)}},{key:"getPersistenceName",value:function(){return"ds_".concat(this.tableName)}},{key:"publish",value:function(){i.a.publish("datasources.".concat(this.name),"update",this.mapInternalToExternalState(this.getState()))}},{key:"unpublish",value:function(){i.a.clearTopics("datasources.".concat(this.name))}},{key:"saveState",value:function(e){return r.default.set(Object(o.a)(this.namespace),this.getPersistenceName(),this.dehydrateState(e))}},{key:"saveCurrentState",value:function(){return this.saveState(this.getState())}},{key:"deleteState",value:function(e){var t=this;return new Promise(function(){return r.default.set(Object(o.a)(e),t.getPersistenceName(),void 0)})}},{key:"loadState",value:function(){var e=this;return new Promise(function(t){if(!e.getPersistenceName())return t();r.default.get(Object(o.a)(e.namespace),e.getPersistenceName()).then(function(n){n&&e.setState(e.rehydrateState(n),!0),t()})})}},{key:"dehydrateState",value:function(e){return e}},{key:"rehydrateState",value:function(e){return e}},{key:"mapInternalToExternalState",value:function(e){return e}},{key:"reducer",value:function(e,t){return t.type,e}},{key:"dispatch",value:function(e){d.forEach(function(t){return t._dispatch(e)})}},{key:"_dispatch",value:function(e){var t=this.getState(),n=this.reducer(t,e);n!==t&&this.setState(n,!1)}},{key:"initialState",get:function(){throw new Error("should be overridden")}}]),e}();function y(){return h.apply(this,arguments)}function h(){return(h=c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(d.map(function(){var e=c(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.dataSourceInitialized;case 2:if(!t.persistState){e.next=5;break}return e.next=5,t.saveCurrentState();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}())));case 1:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function g(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function m(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){g(i,r,o,u,a,"next",e)}function a(e){g(i,r,o,u,a,"throw",e)}u(void 0)})}}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t&&k(e.prototype,t),n&&k(e,n),e}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.subscribe("sync.initialsyncdone",function(){!1===p?(l.log("Initial Load finished."),p=!0,y(),Promise.all(d.map(function(e){return e.dataSourceInitialized.then(function(){e.publish(),e.resolveReady()})})).then(function(){return i.a.publish("app.loading","isLoading",!1,!1)})):i.a.publish("app.loading","isLoading",!1,!1)}),i.a.register("sync.persist",c(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.log("persisting DataSource"),e.next=3,y();case 3:case"end":return e.stop()}},e,this)})));var A={UPDATE_ATTACHMENTS:"SUGAR/ATTACHMENTS/UPDATE_ATTACHMENTS"},_={},P="SUGAR/ATTACHMENTS_DATASOURCE",R=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=O(this,E(t).call(this,_,"attachments",P,!0))).subscribe=function(){var t=i.a.subscribe("attachments",function(t){switch(t.type){case"update":return e.Actions.update(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(t,b),T(t,[{key:"initialState",get:function(){return _}},{key:"Constants",get:function(){return A}}]),T(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case A.UPDATE_ATTACHMENTS:return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){S(e,t,n[t])})}return e}({},e,t.attachments);default:return e}}},{key:"Actions",get:function(){var e=this;return{update:function(t){e.dispatch({type:A.UPDATE_ATTACHMENTS,attachments:t})}}}},{key:"Utils",get:function(){return{}}}]),t}()),N=R;function U(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function x(e,t,n){return t&&D(e.prototype,t),n&&D(e,n),e}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("attachments.actions.getattachments",m(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.dataSourceInitialized;case 2:return e.abrupt("return",R.getState());case 3:case"end":return e.stop()}},e,this)}))),i.a.register("attachments.actions.getattachment",function(){var e=m(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R.dataSourceInitialized;case 2:return e.abrupt("return",R.getState()[t]);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var F={SET_COMM_ENGINE:"SUGAR/COMM_ENGINE/SET_COMM_ENGINE"},K={commEngine:null},B="SUGAR/COMM_ENGINE_DATASOURCE",M=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=G(this,j(t).call(this,K,"commengine",B,!0))).subscribe=function(){var t=i.a.subscribe("commengine",function(t){switch(t.type){case"set":return e.Actions.set(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}(t,b),x(t,[{key:"initialState",get:function(){return K}},{key:"Constants",get:function(){return F}}]),x(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case F.SET_COMM_ENGINE:return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){C(e,t,n[t])})}return e}({},e,{commEngine:t.commEngine});default:return e}}},{key:"Actions",get:function(){var e=this;return{getCommEngine:function(){return e.getState().commEngine},set:function(t){e.dispatch({type:F.SET_COMM_ENGINE,commEngine:t})}}}},{key:"Utils",get:function(){return{}}}]),t}()),V=M;function H(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t,n){return t&&X(e.prototype,t),n&&X(e,n),e}function J(e,t){return(J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("commengine.actions.getcommengine",function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){U(i,r,o,u,a,"next",e)}function a(e){U(i,r,o,u,a,"throw",e)}u(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",M.Actions.getCommEngine());case 1:case"end":return e.stop()}},e,this)})));var Z=Object(u.default)("ion:sugar:Config"),$={SET_CONFIG:"SUGAR/CONFIG/SET_CONFIG"},ee={},te="SUGAR/CONFIG_DATASOURCE",ne=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Y(this,q(t).call(this,ee,"config",te,!0))).subscribe=function(){var t=i.a.subscribe("config",function(t){switch(Z.log("Config subscriber",t),t.type){case"setConfig":var n=t.data,r=n.key,o=n.value;return e.Actions.setConfig(r,o)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}(t,b),Q(t,[{key:"initialState",get:function(){return ee}},{key:"Constants",get:function(){return $}}]),Q(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case $.SET_CONFIG:return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){z(e,t,n[t])})}return e}({},e,z({},t.key,t.value));default:return e}}},{key:"Actions",get:function(){var e=this;return{setConfig:function(t,n){e.dispatch({type:$.SET_CONFIG,key:t,value:n})}}}}]),t}()),re=ne;i.a.register("config.actions.getConfig",function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){H(i,r,o,u,a,"next",e)}function a(e){H(i,r,o,u,a,"throw",e)}u(void 0)})}}(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ne.getState()[t]);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var oe=n(442);function ie(e){return(ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ae(e,t,n[t])})}return e}function ae(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ce(e,t){return!t||"object"!==ie(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t,n){return t&&fe(e.prototype,t),n&&fe(e,n),e}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var de=Object(u.default)("ion:sugar:Flow"),be={UPDATE_FLOWS:"SUGAR/FLOW/UPDATE_FLOWS",FOLLOW_FLOW:"SUGAR/FLOW/FOLLOW_FLOW"},ye=(oe.FlowIds,oe.initialState),he="SUGAR/FLOW_DATASOURCE",ge=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ce(this,se(t).call(this,ye,"flow",he,!1))).Constants=be,e.subscribe=function(){var t=i.a.subscribe("flow",function(t){switch(de.log("Flow subscriber ",t),t.type){case"markCompletedOrIncompleted":return e.Actions.markCompletedOrIncompleted(t.data)}}),n=i.a.subscribe("promotion",function(t){switch(de.log("Promotion subscriber",t),t.type){case"updatePromotion":e.Utils.handleUpdatePromotions([t.data]);break;case"updatePromotions":e.Utils.handleUpdatePromotions(t.data)}});e.unsubscribeFns=[t,n]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}(t,b),le(t,[{key:"initialState",get:function(){return ye}}]),le(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case be.UPDATE_FLOWS:var n=t.flows,r=ue({},e);return Object.keys(n).forEach(function(e){var t=n[e];null!=e&&(r[e]=ue({},r[e],t))}),r;default:return e}}},{key:"Actions",get:function(){var e=this;return{updateFlows:function(t){e.dispatch({type:be.UPDATE_FLOWS,flows:t})},markCompletedOrIncompleted:function(t){var n=ue({},e.getState());Object.keys(t).reduce(function(e,n){return e[n].completed=t[n],e},n),e.Actions.updateFlows(n)}}}},{key:"Utils",get:function(){var e=this;return{handleUpdatePromotions:function(t){var n=e.getState(),r=t.filter(function(e){return e.promotionId&&null!=n[e.promotionId]}).reduce(function(e,t){var n=t.shownCount,r=t.promotionId,o=t.optedOut,i=n>0||!!o;return e[r]=i,e},{});return e.Actions.markCompletedOrIncompleted(r),r}}}}]),t}()),me=n(388);function ve(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function Se(e){return(Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Ee(e,t,n[t])})}return e}function Ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ke(e,t){return!t||"object"!==Se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function we(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ae(e,t,n){return t&&we(e.prototype,t),n&&we(e,n),e}function _e(e,t){return(_e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Pe=Object(u.default)("ion:sugar:HVA"),Re={UPDATE_HVAS:"SUGAR/HVA/UPDATE_HVAS"},Ne="SUGAR/HVA_DATASOURCE",Ue=me.a.HVAUtils.initialState,Ie=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ke(this,Te(t).call(this,Ue,"hva",Ne,!1))).Constants=Re,e.subscribe=function(){var t=i.a.subscribe("promotion",function(n){switch(Pe.log("Promotion Status subscriber ",n),n.type){case"updatePromotion":return e.Actions.updateHVAs([n.data]);case"updatePromotions":return e.Actions.updateHVAs(n.data)}e.unsubscribeFns=[t]})},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_e(e,t)}(t,b),Ae(t,[{key:"initialState",get:function(){return Ue}}]),Ae(t,[{key:"mapInternalToExternalState",value:function(e){var t=Oe({},e),n=t.groupHVAs,r=t.individualHVAs,o=Object.keys(n).reduce(function(e,t){var n=e[t],r=n.promotion&&n.promotion.optedOut;return null!=r&&(n.isComplete=r),e},n),i=Object.keys(r).reduce(function(e,t){var n=e[t],r=o[n.parentId],i=r&&r.isComplete||n.promotion&&n.promotion.optedOut;return null!=i&&(n.isComplete=i),e},r);return{groupHVAs:o,individualHVAs:i}}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Re.UPDATE_HVAS:var n=Oe({},e),r=n.groupHVAs,o=n.individualHVAs;return t.promotions.forEach(function(e){var t=e.promotionId,n=r[t],i=o[t];n?n.promotion=e:i&&(i.promotion=e)}),n;default:return e}}},{key:"Actions",get:function(){var e=this;return{updateHVAs:function(t){e.dispatch({type:Re.UPDATE_HVAS,promotions:t})}}}}]),t}());i.a.register("hva.actions.complete",function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){ve(i,r,o,u,a,"next",e)}function a(e){ve(i,r,o,u,a,"throw",e)}u(void 0)})}}(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i.a.call("promotion.actions.show",[t]));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var Ce,Ge=n(369);function je(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function De(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){je(i,r,o,u,a,"next",e)}function a(e){je(i,r,o,u,a,"throw",e)}u(void 0)})}}function xe(e){return(xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Fe(e,t,n[t])})}return e}function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ke(e,t){return!t||"object"!==xe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Be(e){return(Be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ve(e,t,n){return t&&Me(e.prototype,t),n&&Me(e,n),e}function He(e,t){return(He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(Ce||(Ce={})).SET_IDENTITIES="SUGAR/IDENTITIES/SET_IDENTITIES";var We={identities:{}},ze="SUGAR/IDENTITY_DATASOURCE",Ye=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ke(this,Be(t).call(this,We,"identity",ze,!0))).subscribe=function(){var t=i.a.subscribe("identity",function(t){switch(t.type){case"set":return e.Actions.set(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}(t,b),Ve(t,[{key:"initialState",get:function(){return We}},{key:"Constants",get:function(){return Ce}}]),Ve(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Ce.SET_IDENTITIES:return Le({},e,{identities:Le({},e.identities,t.identities)});default:return e}}},{key:"Actions",get:function(){var e=this;return{getIdentities:function(){return e.getState().identities},getIdentitiesForUser:function(t){var n=e.Actions.getIdentities(),r=Number(t),o="string"==typeof t&&!Number.isInteger(r);return Object.values(n).filter(function(e){return o?e.contact&&e.contact.id===t:e.userId===r})},getIdentitiesForUsers:function(t){return t.map(function(t){var n=e.Actions.getIdentitiesForUser(t);if(n.length>0)return n[0];var r=Number(t),o="string"==typeof t&&!Number.isInteger(r),i=o?Ge.ContactType.EMAIL:Ge.ContactType.EVERNOTE;return Le({id:NaN,contact:{id:t.toString(),type:i}},o?{}:{userId:r})})},set:function(t){t&&e.dispatch({type:Ce.SET_IDENTITIES,identities:t.reduce(function(e,t){return null!=t.id&&(e[t.id]=t),e},{})})}}}},{key:"Utils",get:function(){return{}}}]),t}()),qe=Ye;i.a.register("identity.actions.getidentities",De(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ye.Actions.getIdentities());case 1:case"end":return e.stop()}},e,this)}))),i.a.register("identity.actions.getidentitiesforusers",function(){var e=De(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ye.Actions.getIdentitiesForUsers(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("identity.actions.getidentitiesforuser",function(){var e=De(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ye.Actions.getIdentitiesForUser(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var Xe,Qe=n(56),Je=n.n(Qe);function Ze(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function $e(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){Ze(i,r,o,u,a,"next",e)}function a(e){Ze(i,r,o,u,a,"throw",e)}u(void 0)})}}function et(e){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tt(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){rt(e,t,n[t])})}return e}function rt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ot(e,t){return!t||"object"!==et(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function it(e){return(it=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function at(e,t,n){return t&&ut(e.prototype,t),n&&ut(e,n),e}function ct(e,t){return(ct=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e){e.EXPUNGE_LINKED_NOTEBOOKS="SUGAR/LINKED_NOTEBOOK/EXPUNGE_LINKED_NOTEBOOKS",e.UPDATE_LINKED_NOTEBOOKS="SUGAR/LINKED_NOTEBOOK/UPDATE_LINKED_NOTEBOOKS",e.UPDATE_LINKED_NOTEBOOK_TO_ATTACHMENT_MAP="SUGAR/LINKED_NOTEBOOK/UPDATE_LINKED_NOTEBOOK_TO_ATTACHMENT_MAP"}(Xe||(Xe={}));var st={linkedNotebooks:{},linkedNotebookToAttachment:{},dirtyGuids:new Set},ft="SUGAR/LINKED_NOTEBOOK_DATASOURCE",lt=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ot(this,it(t).call(this,st,"linkednotebook",ft,!0))).subscribe=function(){var t=i.a.subscribe("linkednotebook",function(t){switch(t.type){case"updateLinkedNotebook":return e.Actions.updateLinkedNotebooks([t.data]);case"updateLinkedNotebooks":return e.Actions.updateLinkedNotebooks(t.data);case"updateLinkedNotebooktoAttachmentMap":return e.Actions.updateLinkedNotebooktoAttachmentMap(t.data);case"expungeLinkedNotebook":return e.Actions.expungeLinkedNotebooks([t.data]);case"expungeLinkedNotebooks":return e.Actions.expungeLinkedNotebooks(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ct(e,t)}(t,b),at(t,[{key:"initialState",get:function(){return st}},{key:"Constants",get:function(){return Xe}}]),at(t,[{key:"mapInternalToExternalState",value:function(e){return{linkedNotebooks:e.linkedNotebooks,linkedNotebookToAttachment:e.linkedNotebookToAttachment}}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Xe.UPDATE_LINKED_NOTEBOOKS:return nt({},e,{linkedNotebooks:t.linkedNotebooks.reduce(function(e,t){var n=t.guid,r=tt(t,["guid"]);return n&&(e[n]=nt({},r,{guid:n})),e},nt({},e.linkedNotebooks))});case Xe.EXPUNGE_LINKED_NOTEBOOKS:return nt({},e,{linkedNotebooks:t.guids.reduce(function(e,t){return delete e[t],e},nt({},e.linkedNotebooks))});case Xe.UPDATE_LINKED_NOTEBOOK_TO_ATTACHMENT_MAP:var n=t.attachmentGuid,r=t.linkedNotebookGuid,o=e.linkedNotebooks[r].sharedNotebookGlobalId;return o?nt({},e,{linkedNotebookToAttachment:nt({},e.linkedNotebookToAttachment,rt({},o,n))}):e;default:return e}}},{key:"Actions",get:function(){var e=this;return{expungeLinkedNotebooks:function(t){e.dispatch({type:Xe.EXPUNGE_LINKED_NOTEBOOKS,guids:t})},updateLinkedNotebooks:function(t){e.dispatch({type:Xe.UPDATE_LINKED_NOTEBOOKS,linkedNotebooks:t})},updateLinkedNotebooktoAttachmentMap:function(t){var n=t.attachmentGuid,r=t.linkedNotebookGuid;e.dispatch({type:Xe.UPDATE_LINKED_NOTEBOOK_TO_ATTACHMENT_MAP,attachmentGuid:n,linkedNotebookGuid:r})}}}}]),t}()),pt=lt;i.a.register("linkednotebook.actions.hasnotebook",function(){var e=$e(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt.dataSourceInitialized;case 2:return e.abrupt("return",Object.values(lt.getState().linkedNotebookToAttachment).includes(t));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getlinkednotebookguids",function(){var e=$e(regeneratorRuntime.mark(function e(t){var n,r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt.dataSourceInitialized;case 2:return n=lt.getState(),r=n.linkedNotebookToAttachment,o=n.linkedNotebooks,i=Je.a.invert(r||{})[t],e.abrupt("return",Je.a.filter(o,function(e){return e.sharedNotebookGlobalId===i}).map(function(e){return e.guid}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.hasservicenotebook",function(){var e=$e(regeneratorRuntime.mark(function e(t){var n,r,o,i,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt.dataSourceInitialized;case 2:if(n=lt.getState(),r=n.linkedNotebooks,o=n.linkedNotebookToAttachment,i=r[t],null!=(u=i.sharedNotebookGlobalId)){e.next=7;break}return e.abrupt("return",null);case 7:return e.abrupt("return",o[u]);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getFromGlobalId",function(){var e=$e(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt.dataSourceInitialized;case 2:return e.abrupt("return",Je.a.filter(lt.getState().linkedNotebooks,function(e){return e.sharedNotebookGlobalId===t}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getByGuid",function(){var e=$e(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt.dataSourceInitialized;case 2:return n=lt.getState(),r=n.linkedNotebooks,e.abrupt("return",r[t]);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getlinkednotebook",function(){var e=$e(regeneratorRuntime.mark(function e(t){var n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt.dataSourceInitialized;case 2:if(n=lt.getState(),r=n.linkedNotebookToAttachment,null!=(o=Je.a.invert(r||{})[t])){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,i.a.call("linkednotebook.actions.getFromGlobalId",o);case 8:return e.abrupt("return",e.sent[0]);case 9:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("linkednotebook.actions.getdirty",$e(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,lt.dataSourceInitialized;case 2:if((t=lt.getState()).dirtyGuids){e.next=5;break}return e.abrupt("return",[]);case 5:return e.abrupt("return",Array.from(t.dirtyGuids).map(function(e){return t.linkedNotebooks[e]}));case 6:case"end":return e.stop()}},e,this)})));var dt=n(377),bt=n(113),yt=n(632),ht=n(547),gt=n(440),mt=n(502),vt=n(623),St=n(397);function Ot(e,t){return Object.keys(t).reduce(function(n,r){var o=e[r];return n[r]=o?Je.a.pick(o,Array.from(t[r])):{guid:r,isDeleted:!0},n},{})}function Et(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function kt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){Et(i,r,o,u,a,"next",e)}function a(e){Et(i,r,o,u,a,"throw",e)}u(void 0)})}}function Tt(e){return(Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wt(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function At(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _t(e,t){return!t||"object"!==Tt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Pt(e){return(Pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nt(e,t,n){return t&&Rt(e.prototype,t),n&&Rt(e,n),e}function Ut(e,t){return(Ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Ct(e,t,n[t])})}return e}function Ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Gt,jt="SUGAR/WORKSPACE_DATASOURCE";function Dt(e,t){var n=It({},t.workspaces),r=It({},t.invitations),o=It({},t.identityByInvitationsGuid),i=It({},t.memberships),u=It({},t.workspaceRestrictions),a=It({},t.notebookGuids),c=It({},t.accessInfo),s=It({},t.notebookRestrictions),f=It({},t.aggregations),l=It({},t.activeMemberList);return e.forEach(function(e){delete n[e],delete r[e],delete o[e],delete i[e],delete u[e],delete a[e],delete c[e],delete s[e],delete f[e],delete l[e]}),It({},t,{workspaces:n,invitations:r,identityByInvitationsGuid:o,memberships:i,workspaceRestrictions:u,notebookGuids:a,accessInfo:c,notebookRestrictions:s,aggregations:f,activeMemberList:l,catchupGuids:Je.a.difference(t.catchupGuids,e)})}!function(e){e.UPDATE_WORKSPACES="SUGAR/WORKSPACE/UPDATE_WORKSPACES",e.SAVE_WORKSPACE="SUGAR/WORKSPACE/SAVE_WORKSPACE",e.LEAVE_WORKSPACE="SUGAR/WORKSPACE/LEAVE_WORKSPACE",e.EXPUNGE_WORKSPACES="SUGAR/WORKSPACE/EXPUNGE_NOTEBOOKS",e.SET_WORKSPACE_USER_INTERFACE_PROPERTIES="SUGAR/WORKSPACE/SET_WORKSPACE_USER_INTERFACE_PROPERTIES",e.SET_ACTIVE_MEMBERS="SUGAR/WORKSPACE/SET_ACTIVE_MEMBERS",e.NEEDS_CATCHUP="SUGAR/WORKSPACE/NEEDS_CATCHUP",e.DID_CATCHUP="SUGAR/WORKSPACE/DID_CATCHUP",e.CLEAR_DIRTY_GUID="SUGAR/WORKSPACE/CLEAR_DIRTY_GUID"}(Gt||(Gt={}));var xt={workspaces:{},accessInfo:{},aggregations:{},identityByInvitationsGuid:{},invitations:{},memberships:{},notebookGuids:{},notebookRestrictions:{},workspaceRestrictions:{},workspaceUserInterfaceProperties:{},activeMemberList:{},catchupGuids:[],dirtyFlagsCollection:{}},Lt=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=_t(this,Pt(t).call(this,xt,"workspace",jt,!0))).subscribe=function(){var t=i.a.subscribe("workspace",function(t){switch(t.type){case"setWorkspaceUserInterfaceProperties":return e.Actions.setWorkspaceUserInterfaceProperties(t.data);case"expungeWorkspace":return e.Actions.expunge([t.data]);case"expungeWorkspaces":return e.Actions.expunge(t.data);case"updateWorkspace":return e.Actions.update([t.data]);case"updateWorkspaces":return e.Actions.update(t.data);case"needsCatchup":return e.Actions.needsCatchup(t.data);case"didCatchup":return e.Actions.didCatchup(t.data)}}),n=i.a.subscribe("notebook",function(t){switch(t.type){case"setNotebooksInWorkspaces":vt.getActiveUsersForSpaces(t.data).then(function(t){e.Actions.setActiveUsers(t)})}});e.unsubscribeFns=[t,n]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ut(e,t)}(t,b),Nt(t,[{key:"initialState",get:function(){return xt}},{key:"Constants",get:function(){return Gt}}]),Nt(t,[{key:"mapInternalToExternalState",value:function(e){var t=e.accessInfo,n=e.activeMemberList,r=e.aggregations,o=e.identityByInvitationsGuid,i=e.invitations,u=e.memberships,a=e.notebookRestrictions,c=e.notebookGuids,s=e.workspaceRestrictions,f=e.workspaces,l=e.workspaceUserInterfaceProperties;return Object.entries(f).reduce(function(e,f){var p=At(f,2),d=p[0],b=p[1],y=t[d],h=b.backingNotebookGuid;return null==h?e:(e[d]=It({},b,{guid:d,backingNotebookGuid:h,accessInfo:y,aggregations:r[d],identityByInvitationsGuid:o[d],invitations:i[d],memberships:u[d],notebookGuids:c[d],notebookRestrictions:a[d],restrictions:s[d],activeMembers:n[d]||[],isSeen:vt.isSeen(y),workspaceUserInterfaceProperties:l[d]||null}),e)},{})}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Gt.UPDATE_WORKSPACES:var n=t.workspaces,r=It({},e.workspaces),o=It({},e.invitations),i=It({},e.identityByInvitationsGuid),u=It({},e.memberships),a=It({},e.workspaceRestrictions),c=It({},e.notebookGuids),s=It({},e.accessInfo),f=It({},e.notebookRestrictions),l=It({},e.aggregations);return n.forEach(function(t){var n=t.workspace?t.workspace.guid:t.workspaceGuid;if(null==n)throw new Error("updating a workspace requires a valid guid");var p=r[n];if(null!=p){var d=e.dirtyFlagsCollection[n];if(d){var b=Je.a.pick(p,Array.from(d));Object.assign(t.workspace,b)}}else{var y=e.dirtyFlagsCollection[n];if(y&&y.has("isDeleted"))return}r[n]=t.workspace||e.workspaces[n],o[n]=t.invitations||e.invitations[n],i[n]=t.identityByInvitationsGuid||e.identityByInvitationsGuid[n],u[n]=t.memberships||e.memberships[n],a[n]=t.workspaceRestrictions||e.workspaceRestrictions[n],c[n]=t.notebookGuids||e.notebookGuids[n],s[n]=t.accessInfo||e.accessInfo[n],f[n]=t.notebookRestrictions||e.notebookRestrictions[n],l[n]=t.aggregations||e.aggregations[n]}),It({},e,{workspaces:r,invitations:o,identityByInvitationsGuid:i,memberships:u,workspaceRestrictions:a,notebookGuids:c,accessInfo:s,notebookRestrictions:f,aggregations:l});case Gt.SAVE_WORKSPACE:var p=t.workspace,d=p.guid;if(null==d)throw new Error("saving a workspace requires a valid guid");var b=It({},e.workspaces);p.guid&&(b[p.guid]=It({},b[p.guid],p));var y=It({},e.dirtyFlagsCollection),h=y[d]||new Set;return Object.keys(p).forEach(function(e){h.add(e)}),y[d]=h,It({},e,{workspaces:b,dirtyFlagsCollection:y});case Gt.LEAVE_WORKSPACE:var g=t.guid,m=Dt([g],e),v=It({},e.dirtyFlagsCollection);return v[g]=new Set(["isDeleted"]),It({},m,{dirtyFlagsCollection:v});case Gt.EXPUNGE_WORKSPACES:return Dt(t.guids,e);case Gt.SET_WORKSPACE_USER_INTERFACE_PROPERTIES:var S=It({},e.workspaceUserInterfaceProperties);return S[t.guid]=t.workspaceUserInterfaceProperties,It({},e,{workspaceUserInterfaceProperties:S});case Gt.SET_ACTIVE_MEMBERS:return It({},e,{activeMemberList:t.activeUserMap});case Gt.NEEDS_CATCHUP:var O=t.guids;return It({},e,{catchupGuids:Je.a.uniq([].concat(wt(e.catchupGuids),wt(O)))});case Gt.DID_CATCHUP:var E=t.guids;return It({},e,{catchupGuids:Je.a.difference(e.catchupGuids,E)});case Gt.CLEAR_DIRTY_GUID:var k=It({},e.dirtyFlagsCollection);return delete k[t.guid],It({},e,{dirtyFlagsCollection:k});default:return e}}},{key:"Actions",get:function(){var e=this;return{update:function(t){var n=e.getState(),r=t.filter(function(e){var t=e.workspace;return null==t||null==t.guid||((n.workspaces[t.guid]||{}).updateSequenceNum||0)<=(t.updateSequenceNum||0)});e.dispatch({type:Gt.UPDATE_WORKSPACES,workspaces:r})},setWorkspaceUserInterfaceProperties:function(t){var n=t.guid,r=t.workspaceUserInterfaceProperties;e.dispatch({type:Gt.SET_WORKSPACE_USER_INTERFACE_PROPERTIES,guid:n,workspaceUserInterfaceProperties:r})},expunge:function(t){e.dispatch({type:Gt.EXPUNGE_WORKSPACES,guids:t})},leave:function(t){var n=nn.getState();(n.workspaceGuidToNotebookGuids.getValuesAsArray(t)||[]).map(function(e){return n.notebooks[e]}).filter(function(e){return null==e.sharedNotebooks}).map(function(e){return e.guid}).forEach(function(e){return nn.Actions.deleteNotebook(e,!1)}),e.dispatch({type:Gt.LEAVE_WORKSPACE,guid:t})},setActiveUsers:function(t){e.dispatch({type:Gt.SET_ACTIVE_MEMBERS,activeUserMap:t})},needsCatchup:function(t){e.dispatch({type:Gt.NEEDS_CATCHUP,guids:t})},didCatchup:function(t){e.dispatch({type:Gt.DID_CATCHUP,guids:t})}}}}]),t}()),Ft=Lt;i.a.register("workspace.actions.getworkspaceresponse",function(){var e=kt(regeneratorRuntime.mark(function e(t){var n,r,o,i,u,a,c,s,f,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lt.dataSourceInitialized;case 2:return n=Lt.getState(),r=n.accessInfo,o=n.aggregations,i=n.identityByInvitationsGuid,u=n.invitations,a=n.memberships,c=n.notebookGuids,s=n.notebookRestrictions,f=n.workspaceRestrictions,l=n.workspaces,e.abrupt("return",new St.WorkspaceResponse({workspace:l[t],invitations:u[t],identityByInvitationsGuid:i[t],memberships:a[t],notebookGuids:c[t],workspaceRestrictions:f[t],aggregations:o[t],notebookRestrictions:s[t],accessInfo:r[t]}));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("workspace.actions.getCatchupGuids",kt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lt.dataSourceInitialized;case 2:return e.abrupt("return",wt(Lt.getState().catchupGuids));case 3:case"end":return e.stop()}},e,this)}))),i.a.register("workspace.actions.getdirty",kt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lt.dataSourceInitialized;case 2:return t=Lt.getState(),e.abrupt("return",Ot(t.workspaces,t.dirtyFlagsCollection));case 4:case"end":return e.stop()}},e,this)}))),i.a.register("workspace.actions.cleardirty",function(){var e=kt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lt.dataSourceInitialized;case 2:Lt.dispatch({type:Gt.CLEAR_DIRTY_GUID,guid:t});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("workspace.actions.updateLocal",function(){var e=kt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lt.dataSourceInitialized;case 2:Lt.dispatch({type:Gt.SAVE_WORKSPACE,workspace:t}),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("workspace.actions.leavelocal",function(){var e=kt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Lt.dataSourceInitialized;case 2:Lt.Actions.leave(t),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var Kt=n(427);function Bt(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function Mt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){Bt(i,r,o,u,a,"next",e)}function a(e){Bt(i,r,o,u,a,"throw",e)}u(void 0)})}}function Vt(e){return(Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Wt(e,t,n[t])})}return e}function Wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zt(e,t){return!t||"object"!==Vt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Yt(e){return(Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Xt(e,t,n){return t&&qt(e.prototype,t),n&&qt(e,n),e}function Qt(e,t){return(Qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Jt=Object(u.default)("ion:sugar:Notebook"),Zt="SUGAR/NOTEBOOK_DATASOURCE",$t={UPDATE_NOTEBOOKS:"SUGAR/NOTEBOOK/UPDATE_NOTEBOOKS",SAVE_NOTEBOOK:"SUGAR/NOTEBOOK/SAVE_NOTEBOOK",CLEAR_DIRTY_GUID:"SUGAR/NOTEBOOK/CLEAR_DIRTY_GUID",DELETE_NOTEBOOK_LOCAL:"SUGAR/NOTEBOOK/DELETE_NOTEBOOK_LOCAL",EXPUNGE_NOTEBOOKS:"SUGAR/NOTEBOOK/EXPUNGE_NOTEBOOKS",SET_DEFAULT_NOTEBOOK:"SUGAR/NOTEBOOK/SET_DEFAULT_NOTEBOOK",SET_USER_NOTEBOOK:"SUGAR/NOTEBOOK/SET_USER_NOTEBOOK",NEEDS_CATCHUP:"SUGAR/NOTEBOOK/NEEDS_CATCHUP",DID_CATCHUP:"SUGAR/NOTEBOOK/DID_CATCHUP"},en={workspaceGuidToNotebookGuids:bt.a.createEmptyMap(),notebookToUpdateInfo:{},notebooks:{},defaultNotebook:null,userNotebook:null,catchupNotebooks:{},dirtyFlagsCollection:{}},tn=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=zt(this,Yt(t).call(this,en,"notebook",Zt,!0))).Constants=$t,e.subscribe=function(){var t=i.a.subscribe("notebook",function(t){switch(Jt.log("Notebook subscriber ",t),t.type){case"defaultNotebook":return e.Actions.setDefaultNotebook(t.data);case"didCatchup":return e.Actions.didCatchup(t.data);case"expungeNotebook":return e.Actions.expungeNotebooks([t.data]);case"expungeNotebooks":return e.Actions.expungeNotebooks(t.data);case"needsCatchup":return e.Actions.needsCatchup(t.data);case"updateNotebook":var n=t.data,r=n.notebook,o=n.sharedNotebooks;return e.Actions.updateNotebooks({notebooks:[r],sharedNotebooks:o});case"updateNotebooks":var i=t.data,u=i.notebooks,a=i.sharedNotebooks;return e.Actions.updateNotebooks({notebooks:u,sharedNotebooks:a});case"userNotebook":return e.Actions.setUserNotebook(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Qt(e,t)}(t,b),Xt(t,[{key:"initialState",get:function(){return en}}]),Xt(t,[{key:"rehydrateState",value:function(e){return Ht({},e,{workspaceGuidToNotebookGuids:bt.a.createFromSameInstance(e.workspaceGuidToNotebookGuids)})}},{key:"mapInternalToExternalState",value:function(e){var t=e.notebooks,n=e.notebookToUpdateInfo,r=e.workspaceGuidToNotebookGuids,o=e.defaultNotebook,i=e.userNotebook,u=bt.a.createFromSameInstance(r);return{maxUpdatedMap:Object.keys(n).reduce(function(e,t){return e[t]=n[t].lastUpdatedTime,e},{}),notebooks:t,notebookToLastEditedUserIdMap:Object.keys(n).reduce(function(e,t){return e[t]=n[t].lastUpdatedUserId,e},{}),notebookToWorkspaceMap:u.getInwardObject(),defaultNotebook:o,userNotebook:i,workspaceToNotebooksMap:u.getForwardObject()}}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case $t.UPDATE_NOTEBOOKS:var n=t.notebooks,r=t.sharedNotebooks,o=Ht({},e.notebooks),i=Je.a.cloneDeep(e.notebookToUpdateInfo);n.forEach(function(t){if(null!=t.guid){var n=t.guid,r=o[n];if(null!=r){null!=r.isTrueOwner&&null==t.isTrueOwner&&(t.isTrueOwner=r.isTrueOwner),null!=r.isOwnedByMyVaultUser&&null==t.isOwnedByMyVaultUser&&(t.isOwnedByMyVaultUser=r.isOwnedByMyVaultUser),null!=r.shardIdFromSharedAuth&&null==t.shardIdFromSharedAuth&&(t.shardIdFromSharedAuth=r.shardIdFromSharedAuth);var u=e.dirtyFlagsCollection[n];if(u){var a=Je.a.pick(r,Array.from(u));Object.assign(t,a)}}else{var c=e.dirtyFlagsCollection[n];if(c&&c.has("isDeleted"))return}o[n]=t;var s=t&&t.serviceUpdated,f=i[n]&&i[n].lastUpdatedTime;f&&s?i[n]=Ht({},i[n],{lastUpdatedTime:Math.max(s,f)}):s&&(i[n]=Ht({},i[n],{lastUpdatedTime:s}))}}),r&&r.forEach(function(e){if(null==e.notebookGuid)throw new Error("".concat(e.notebookGuid," should be present"));var t=o[e.notebookGuid];t&&(null==t.sharedNotebooks&&t.sharedNotebookIds&&t.sharedNotebookIds.length>0?t.sharedNotebooks=[e]:t.sharedNotebooks&&t.sharedNotebookIds&&t.sharedNotebooks.length!==t.sharedNotebookIds.length&&t.sharedNotebooks.push(e),o[e.notebookGuid]=t)});var u=bt.a.createFromSameInstance(e.workspaceGuidToNotebookGuids);n.forEach(function(e){null!=e.workspaceGuid?u.set(e.workspaceGuid,e.guid):u.removeValue(e.guid)});var a=n.find(function(e){return Boolean(e.defaultNotebook||e.recipientSettings&&e.recipientSettings.recipientStatus===Ge.RecipientStatus.IN_MY_LIST_AND_DEFAULT_NOTEBOOK)})||e.defaultNotebook,c=null!=a?Ht({},a):null,s=null!=e.userNotebook?Ht({},e.userNotebook):null;return Ht({},e,{notebooks:o,notebookToUpdateInfo:i,workspaceGuidToNotebookGuids:u,defaultNotebook:c,userNotebook:s});case $t.EXPUNGE_NOTEBOOKS:var f=t.guids,l=Ht({},e.notebooks),p=bt.a.createFromSameInstance(e.workspaceGuidToNotebookGuids),d=Ht({},e.dirtyFlagsCollection);f.forEach(function(e){p.removeValue(e),delete l[e],delete d[e]});var b=Ht({},e.catchupNotebooks);return f.forEach(function(e){delete b[e]}),Ht({},e,{notebooks:l,workspaceGuidToNotebookGuids:p,catchupNotebooks:b,dirtyFlagsCollection:d});case $t.DELETE_NOTEBOOK_LOCAL:var y=t.guid,h=t.markDirty,g=Ht({},e.notebooks);delete g[y];var m=Ht({},e.dirtyFlagsCollection);return h&&(m[y]=new Set(["isDeleted"])),Ht({},e,{notebooks:g,dirtyFlagsCollection:m});case $t.SAVE_NOTEBOOK:var v=t.changes,S=v.guid,O=v.name,E=v.workspaceGuid;if(null!=O)if(!mt.a.validateWithoutUnique({name:O}).isValid)throw Error("Notebook name failed validation");var k=Ht({},e.dirtyFlagsCollection),T=k[S]||new Set;Object.keys(t.changes).forEach(function(e){T.add(e)}),k[S]=T;var w=Ht({},e.notebooks[S],t.changes),A=Ht({},e.notebooks,Wt({},S,w)),_=e.workspaceGuidToNotebookGuids;return void 0!==E&&(_=bt.a.createFromSameInstance(e.workspaceGuidToNotebookGuids),null!=E?_.set(E,S):_.removeValue(S)),Ht({},e,{notebooks:A,dirtyFlagsCollection:k,workspaceGuidToNotebookGuids:_});case Gt.EXPUNGE_WORKSPACES:var P=t.guids,R=bt.a.createFromSameInstance(e.workspaceGuidToNotebookGuids);return P.forEach(function(e){return R.removeKey(e)}),Ht({},e,{workspaceGuidToNotebookGuids:R});case Gt.LEAVE_WORKSPACE:var N=t.guid,U=bt.a.createFromSameInstance(e.workspaceGuidToNotebookGuids);return U.removeKey(N),Ht({},e,{workspaceGuidToNotebookGuids:U});case $t.SET_DEFAULT_NOTEBOOK:var I=t.notebook;return Ht({},e,{notebooks:Ht({},e.notebooks,Wt({},I.guid,I)),defaultNotebook:I});case $t.SET_USER_NOTEBOOK:var C=t.notebook;return Ht({},e,{notebooks:Ht({},e.notebooks,Wt({},C.guid,C)),userNotebook:C});case $t.NEEDS_CATCHUP:var G=t.guids,j=t.locator,D=G.reduce(function(e,t){return e[t]={guid:t,personal:j.personal,shard:j.shard,sharedToMe:j.sharedToMe},e},{});return Ht({},e,{catchupNotebooks:Ht({},e.catchupNotebooks,D)});case $t.DID_CATCHUP:var x=t.guids,L=Ht({},e.catchupNotebooks);return x.forEach(function(e){delete L[e]}),Ht({},e,{catchupNotebooks:L});case In.UPDATE_NOTES:var F=Ht({},e.notebookToUpdateInfo),K=t.notes.reduce(function(t,n){var r=n.notebookGuid,o=n.updated;if(null==r)return t;var i=e.notebooks[r],u=i&&i.serviceUpdated,a=t[r]&&t[r].lastUpdatedTime;return null==a&&(t[r]={lastUpdatedTime:u,lastUpdatedUserId:null},a=u),a&&o&&o>a&&(t[r].lastUpdatedTime=o,t[r].lastUpdatedUserId=n.attributes?n.attributes.lastEditorId:null),t},F);return Ht({},e,{notebookToUpdateInfo:K});case $t.CLEAR_DIRTY_GUID:var B=Ht({},e.dirtyFlagsCollection);return delete B[t.guid],Ht({},e,{dirtyFlagsCollection:B});default:return e}}},{key:"Actions",get:function(){var e=this;return{updateNotebooks:function(t){var n=t.notebooks,r=t.sharedNotebooks,o=e.getState().notebooks,i=n.filter(function(e){return((o[e.guid]||{}).updateSequenceNum||0)<=(e.updateSequenceNum||0)});e.dispatch({type:$t.UPDATE_NOTEBOOKS,notebooks:i,sharedNotebooks:r})},expungeNotebooks:function(t){e.dispatch({type:$t.EXPUNGE_NOTEBOOKS,guids:t}),t.length>0&&Object(Kt.d)(t)},deleteNotebook:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.getState(),o=r.notebooks,i=r.defaultNotebook,u=o[t].isTrueOwner;if(u&&(!i||i.guid===t))throw Error("User is attempting to delete a notebook without a valid fallback notebook.");var a=u&&i&&i.guid;e.dispatch({type:$t.DELETE_NOTEBOOK_LOCAL,guid:t,notebookGuidForSalvagedNotes:a,markDirty:n})},saveNotebook:function(t){e.dispatch({type:$t.SAVE_NOTEBOOK,changes:t})},setDefaultNotebook:function(t){e.dispatch({type:$t.SET_DEFAULT_NOTEBOOK,notebook:t})},setUserNotebook:function(t){e.dispatch({type:$t.SET_USER_NOTEBOOK,notebook:t})},needsCatchup:function(t){var n=t.guids,r=void 0===n?[]:n,o=t.locator;e.dispatch({type:$t.NEEDS_CATCHUP,guids:r,locator:o})},didCatchup:function(t){e.dispatch({type:$t.DID_CATCHUP,guids:t})}}}},{key:"Utils",get:function(){return{validateName:mt.a.validationWithoutUnique.name}}}]),t}()),nn=tn;function rn(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function on(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){rn(i,r,o,u,a,"next",e)}function a(e){rn(i,r,o,u,a,"throw",e)}u(void 0)})}}function un(e){return(un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function an(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){cn(e,t,n[t])})}return e}function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sn(e,t){return!t||"object"!==un(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fn(e){return(fn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pn(e,t,n){return t&&ln(e.prototype,t),n&&ln(e,n),e}function dn(e,t){return(dn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("notebook.actions.getparentworkspace",function(e){return new Promise(function(t){tn.dataSourceInitialized.then(function(){var n=(tn.getState().notebooks[e]||{}).workspaceGuid;n?i.a.call("workspace.actions.getworkspaceresponse",n).then(function(e){t(e.workspace)}).catch(function(){t(null)}):t(null)})})}),i.a.register("notebook.actions.getnotebook",function(){var e=Mt(regeneratorRuntime.mark(function e(t){var n,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}throw new Error("guid is requires for getNotebook call");case 2:return e.next=4,tn.dataSourceInitialized;case 4:if(n=tn.getState(),r=n.notebooks[t]){e.next=8;break}return e.abrupt("return");case 8:return o=n.dirtyFlagsCollection[t]||new Set,e.abrupt("return",Ht({},r,{dirtyFlags:o}));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.hasnotebook",function(){var e=Mt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t in(tn.getState().notebooks||{}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.updatelocal",function(){var e=Mt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:tn.dispatch({type:$t.SAVE_NOTEBOOK,changes:t}),i.a.publish("sync.notes");case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.expungeNotebookLocal",function(){var e=Mt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tn.dataSourceInitialized;case 2:tn.Actions.deleteNotebook(t),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.hasnotebooks",function(){var e=Mt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Je.a.difference(t,Object.keys(tn.getState().notebooks||{})));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("notebook.actions.notebooksinworkspaces",Mt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=tn.mapInternalToExternalState(tn.getState()),e.abrupt("return",t.notebookToWorkspaceMap);case 2:case"end":return e.stop()}},e,this)}))),i.a.register("notebook.actions.getCatchupNotebooks",Mt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tn.dataSourceInitialized;case 2:return e.abrupt("return",Object.values(tn.getState().catchupNotebooks));case 3:case"end":return e.stop()}},e,this)}))),i.a.register("notebook.actions.getWorkspaceToNotebookGuids",Mt(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tn.dataSourceInitialized;case 2:return e.abrupt("return",tn.getState().workspaceGuidToNotebookGuids);case 3:case"end":return e.stop()}},e,this)}))),i.a.register("notebook.actions.getdirty",Mt(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tn.dataSourceInitialized;case 2:return t=tn.getState(),e.abrupt("return",Ot(t.notebooks,t.dirtyFlagsCollection));case 4:case"end":return e.stop()}},e,this)}))),i.a.register("notebook.actions.cleardirty",function(){var e=Mt(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tn.dataSourceInitialized;case 2:tn.dispatch({type:$t.CLEAR_DIRTY_GUID,guid:t});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var bn=Object(u.default)("ion:sugar:Tag"),yn="SUGAR/TAG_DATASOURCE",hn={CLEAR_DIRTY:"SUGAR/TAG/CLEAR_DIRTY",DELETE_TAGS:"SUGAR/TAG/DELETE_TAGS",DELETE_TAG_LOCAL:"SUGAR/TAG/DELETE_TAG_LOCAL",UPDATE_TAGS:"SUGAR/TAG/UPDATE_TAGS",UPDATE_BOOTSTRAP_TAG_COUNTS_BY_GUID:"SUGAR/TAG/UPDATE_BOOTSTRAP_TAG_COUNTS_BY_GUID",SHARED_TAGS_COUNT_BY_NAME:"SUGAR/TAG/SHARED_TAGS_COUNT_BY_NAME",UPDATE_SHARED_TAGS_BY_NOTEBOOK:"SUGAR/TAG/UPDATE_SHARED_TAGS_BY_NOTEBOOK"},gn={tags:{},bootstrapTagCountsByGuid:{},tagsBySharedNotebookGuid:{},sharedNotebookTagCountsByName:{},dirtyFlagsCollection:{}},mn=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=sn(this,fn(t).call(this,gn,"tag",yn,!0))).subscribe=function(){var t=i.a.subscribe("tag",function(t){switch(bn.log("Tag subscriber ",t),t.type){case"updateTag":return e.Actions.updateTags([t.data]);case"updateTags":return e.Actions.updateTags(t.data);case"deleteTag":return e.Actions.deleteTags([t.data]);case"deleteTags":return e.Actions.deleteTags(t.data);case"countTag":return e.Actions.updateBootstrapTagCountsByGuid(t.data);case"updateSharedTags":return e.Actions.updateSharedTags(t.data);case"countSharedTags":return e.Actions.updateSharedTagsCountByName(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dn(e,t)}(t,b),pn(t,[{key:"initialState",get:function(){return gn}},{key:"Constants",get:function(){return hn}}]),pn(t,[{key:"mapInternalToExternalState",value:function(e){return{tags:e.tags,bootstrapTagCountsByGuid:e.bootstrapTagCountsByGuid,tagsBySharedNotebookGuid:e.tagsBySharedNotebookGuid,sharedNotebookTagCountsByName:e.sharedNotebookTagCountsByName}}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case hn.DELETE_TAGS:var n=t.guids,r=an({},e.tags);return n.reduce(function(e,t){return delete e[t],e},r),an({},e,{tags:r});case hn.DELETE_TAG_LOCAL:var o=t.guid,i=an({},e.tags),u=an({},e.dirtyFlagsCollection);return delete i[o],u[o]=new Set(["isDeleted"]),an({},e,{tags:i,dirtyFlagsCollection:u});case hn.CLEAR_DIRTY:var a=t.guid,c=an({},e.dirtyFlagsCollection);return delete c[a],an({},e,{dirtyFlagsCollection:c});case hn.UPDATE_TAGS:var s=t.tags,f=an({},e.tags);return s.reduce(function(e,t){var n=t.guid,r=t.name;if(null==n||null==r)return e;var o=an({},e[n]||{},t,{guid:n,name:r});return e[n]=o,e},f),an({},e,{tags:f});case hn.UPDATE_SHARED_TAGS_BY_NOTEBOOK:var l=t.tags,p=t.notebookGuid,d=an({},e.tagsBySharedNotebookGuid[p]);return d=l.reduce(function(e,t){var n=t.guid,r=t.name;if(null==n||null==r)return e;var o=an({},e[n]||{},t,{guid:n,name:r});return e[n]=o,e},d),an({},e,{tagsBySharedNotebookGuid:an({},e.tagsBySharedNotebookGuid,cn({},p,d))});case hn.UPDATE_BOOTSTRAP_TAG_COUNTS_BY_GUID:var b=t.noteCollection;return null==b.tagCounts?e:an({},e,{bootstrapTagCountsByGuid:an({},b.tagCounts)});case hn.SHARED_TAGS_COUNT_BY_NAME:var y=t.noteCollection,h=t.notebookGuid,g=an({},e.tagsBySharedNotebookGuid[h]),m={};return Object.keys(y.tagCounts||{}).forEach(function(e){m[g[e].name]=y.tagCounts&&y.tagCounts[e]||0}),an({},e,{sharedNotebookTagCountsByName:an({},e.sharedNotebookTagCountsByName,cn({},h,m))});default:return e}}},{key:"Actions",get:function(){var e=this;return{updateTags:function(t){e.dispatch({type:hn.UPDATE_TAGS,tags:t})},updateBootstrapTagCountsByGuid:function(t){e.dispatch({type:hn.UPDATE_BOOTSTRAP_TAG_COUNTS_BY_GUID,noteCollection:t})},deleteTags:function(t){e.dispatch({type:hn.DELETE_TAGS,guids:t})},updateSharedTags:function(t){var n=t.tags,r=t.guid;e.dispatch({type:hn.UPDATE_SHARED_TAGS_BY_NOTEBOOK,tags:n,notebookGuid:r})},updateSharedTagsCountByName:function(t){var n=t.noteCollection,r=t.notebookGuid;e.dispatch({type:hn.SHARED_TAGS_COUNT_BY_NAME,noteCollection:n,notebookGuid:r})}}}},{key:"Utils",get:function(){return{validateName:mt.b.validation.name}}}]),t}()),vn=mn;function Sn(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function On(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){Sn(i,r,o,u,a,"next",e)}function a(e){Sn(i,r,o,u,a,"throw",e)}u(void 0)})}}function En(e){return(En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kn(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){wn(e,t,n[t])})}return e}function wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function An(e,t){return!t||"object"!==En(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _n(e){return(_n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Rn(e,t,n){return t&&Pn(e.prototype,t),n&&Pn(e,n),e}function Nn(e,t){return(Nn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("tag.actions.getdirty",on(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.dataSourceInitialized;case 2:return t=mn.getState(),e.abrupt("return",Ot(t.tags,t.dirtyFlagsCollection));case 4:case"end":return e.stop()}},e,this)}))),i.a.register("tag.actions.deleteLocal",function(){var e=on(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.dataSourceInitialized;case 2:mn.dispatch({type:hn.DELETE_TAG_LOCAL,guid:t}),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("tag.actions.cleardirty",function(){var e=on(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.dataSourceInitialized;case 2:mn.dispatch({type:hn.CLEAR_DIRTY,guid:t});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var Un,In,Cn=Object(u.default)("ion:sugar:Note"),Gn=Object(u.default)("ceReloadDebug:sugar"),jn="SUGAR/NOTE_DATASOURCE";!function(e){e.NO_CONTAINER="NOTE_REMOVING_RULES/NO_CONTAINER"}(Un||(Un={})),function(e){e.UPDATE_NOTES="SUGAR/NOTE/UPDATE_NOTES",e.EXPUNGE_NOTES="SUGAR/NOTE/EXPUNGE_NOTES",e.DELETE_LOCAL="SUGAR/NOTE/DELETE_LOCAL",e.SELECT_NOTE="SUGAR/NOTE/SELECT_NOTE",e.CLEAR_DIRTY="SUGAR/NOTE/CLEAR_DIRTY",e.UPDATE_LOCK="SUGAR/NOTE/UPDATE_LOCK"}(In||(In={}));var Dn={accessibleNotebookGuids:[],notebookGuidToNoteGuids:bt.a.createEmptyMap(),notes:{},selectedNotes:{},dirtyFlagsCollection:{},locks:{},nextNotesDiff:{}},xn=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=An(this,_n(t).call(this,Dn,"note",jn,!0))).Constants=In,e.subscribe=function(){var t=i.a.subscribe("note",function(t){switch(t.type){case"updateNote":return e.Actions.updateNotes([t.data.note],t.data.resultSpec,t.data.locator);case"updateNotes":return e.Actions.updateNotes(t.data.notes,t.data.resultSpec,t.data.locator);case"expungeNote":return e.Actions.expungeNotes([t.data]);case"expungeNotes":return e.Actions.expungeNotes(t.data);case"expungeNotesNoLongerSharedWithMe":return e.Actions.expungeNotesSelectively(t.data.noteGuids,Un.NO_CONTAINER);case"selectNote":return e.Actions.selectNote(t.data.guid,t.data.windowId);case"updateLock":return e.Actions.updateLock(t.data.guid,t.data.lockState)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nn(e,t)}(t,b),Rn(t,[{key:"initialState",get:function(){return Dn}}]),Rn(t,[{key:"rehydrateState",value:function(e){return Tn({},e,{notebookGuidToNoteGuids:bt.a.createFromSameInstance(e.notebookGuidToNoteGuids)})}},{key:"mapInternalToExternalState",value:function(e){return{dirtyGuids:Object.keys(e.dirtyFlagsCollection),locks:e.locks,nextNotesDiff:e.nextNotesDiff}}},{key:"saveState",value:function(e){var t=e.accessibleNotebookGuids,n=e.notebookGuidToNoteGuids,i=Tn({},e.notes);"web"===gt.a.platformName&&Object.values(e.selectedNotes).forEach(function(e){var t=i[e];t&&(i[e]=Tn({},t,{content:null}))});var u=Tn({},Dn,{accessibleNotebookGuids:t,notebookGuidToNoteGuids:n,notes:i});return r.default.set(Object(o.a)(this.namespace),this.getPersistenceName(),u)}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case In.UPDATE_NOTES:var n=t.notes,r=t.resultSpec,o=Tn({},e.notes),i={};n.forEach(function(t){var n=e.notes[t.guid]||{},u=Tn({},n,t),a=n.updateSequenceNum||0,c=t.updateSequenceNum||0,s=e.dirtyFlagsCollection[u.guid];s&&s.has("isDeleted")||(null!=t.content||r.includeContent||(u.content=n.content||null,n.content&&!Je.a.isEqual(t.contentHash,n.contentHash)&&a<c&&(Gn.trace("marking note guid=(".concat(u.guid,") as STALE")),u.stale=!0)),!t.content&&n.content||(Gn.log("marking note guid=(".concat(u.guid,") as NOT STALE")),u.stale=!1),null!=t.sharedNotes||r.includeSharedNotes||(u.sharedNotes=n.sharedNotes||null),null!=t.resources||r.includeContent||(u.resources=n.resources||null),null!=t.limits||r.includeAccountLimits||(u.limits=n.limits||null),null==u.contentHash&&(u.contentHash=n.contentHash||null),null==u.contentLength&&(u.contentLength=n.contentLength||null),o[t.guid]=u,i[t.guid]=u)});var u=bt.a.createFromSameInstance(e.notebookGuidToNoteGuids);return n.filter(function(t){return e.accessibleNotebookGuids.includes(t.notebookGuid)}).forEach(function(e){u.set(e.notebookGuid,e.guid)}),Tn({},e,{notebookGuidToNoteGuids:u,notes:o,nextNotesDiff:i});case $t.UPDATE_NOTEBOOKS:var a=t.notebooks.map(function(e){return e.guid}).filter(function(t){return!e.accessibleNotebookGuids.includes(t)}).concat(e.accessibleNotebookGuids),c=bt.a.createFromSameInstance(e.notebookGuidToNoteGuids);return Object.keys(e.notes).map(function(t){return e.notes[t]}).forEach(function(e){a.includes(e.notebookGuid)&&c.set(e.notebookGuid,e.guid)}),Tn({},e,{accessibleNotebookGuids:a,notebookGuidToNoteGuids:c,nextNotesDiff:{}});case $t.EXPUNGE_NOTEBOOKS:var s=t.guids,f=e.accessibleNotebookGuids.filter(function(e){return!s.includes(e)}),l=bt.a.createFromSameInstance(e.notebookGuidToNoteGuids),p={},d=Je.a.flatMap(s,function(e){return l.getValuesAsArray(e)||[]}).map(function(t){return e.notes[t]}).filter(ht.isNoteExpungeableWithoutContainerNotebook).map(function(e){return e.guid}).reduce(function(e,t){return delete e[t],p[t]=null,e},Tn({},e.notes));return s.forEach(function(e){l.removeKey(e)}),Tn({},e,{accessibleNotebookGuids:f,notebookGuidToNoteGuids:l,notes:d,nextNotesDiff:p});case hn.DELETE_TAG_LOCAL:var b=t.guid,y=Tn({},e.notes),h={};return Object.keys(y).forEach(function(e){var t=y[e];if(t.tagGuids){var n=t.tagGuids.indexOf(b);if(n>=0){var r=kn(t.tagGuids);r.splice(n,1),y[e]=Tn({},t,{tagGuids:r}),h[e]=y[e]}}}),Tn({},e,{notes:y,nextNotesDiff:h});case $t.DELETE_NOTEBOOK_LOCAL:var g=t.guid,m=t.notebookGuidForSalvagedNotes,v=e.notebookGuidToNoteGuids.getValuesAsArray(g);if(!v)return e;var S=Tn({},e.notes),O=bt.a.createFromSameInstance(e.notebookGuidToNoteGuids);O.removeKey(g);var E={};return v.forEach(function(e){m&&null!=S[e]?(S[e]=Tn({},S[e],{active:!1,notebookGuid:m}),E[e]=S[e],O.set(m,e)):(E[e]=null,delete S[e])}),Tn({},e,{notes:S,notebookGuidToNoteGuids:O,nextNotesDiff:E});case In.EXPUNGE_NOTES:var k,T=t.guids,w=t.predicate,A=bt.a.createFromSameInstance(e.notebookGuidToNoteGuids);switch(w){case Un.NO_CONTAINER:k=function(e){return!!e&&!A.hasValue(e.guid)};break;default:k=function(e){return!!e}}var _=T.map(function(t){return e.notes[t]}).filter(k).map(function(e){return e.guid}),P={},R=_.reduce(function(e,t){return delete e[t],P[t]=null,e},Tn({},e.notes));return _.forEach(function(e){A.removeValue(e)}),Tn({},e,{notebookGuidToNoteGuids:A,notes:R,nextNotesDiff:P});case In.DELETE_LOCAL:var N=t.guids,U=bt.a.createFromSameInstance(e.notebookGuidToNoteGuids),I={},C=N.reduce(function(e,t){return delete e[t],I[t]=null,e},Tn({},e.notes)),G=Tn({},e.dirtyFlagsCollection);return N.forEach(function(e){U.removeValue(e),G[e]=new Set(["isDeleted"])}),Tn({},e,{notebookGuidToNoteGuids:U,notes:C,dirtyFlagsCollection:G,nextNotesDiff:I});case In.SELECT_NOTE:var j=e.notes,D=t.guid,x=t.windowId,L=void 0===x?"default":x,F=e.selectedNotes[L],K=e.notes[F],B=e.locks||{};if(F===D)return e;var M={};if(null!=K){var V="web"===gt.a.platformName?Tn({},K,{_marshalledResources:null,content:null,resources:null}):Tn({},K);M[V.guid]=V,null!=V.guid&&(j=Tn({},j,wn({},V.guid,V)))}var H=Tn({},e.selectedNotes,wn({},L,D)),W=Object.keys(H).map(function(e){return H[e]}),z=Je.a.difference(Object.keys(B),W).reduce(function(e,t){return delete e[t],e},B);return D&&null==z[D]&&(z[D]=this.Utils.getInitialLockState()),Tn({},e,{notes:j,selectedNotes:H,locks:z,nextNotesDiff:M});case In.UPDATE_LOCK:var Y=t.guid,q=t.lockState,X=Tn({},e.locks);return X[Y]=Tn({},this.Utils.getInitialLockState(),X[Y],q),Tn({},e,{locks:X,nextNotesDiff:{}});case In.CLEAR_DIRTY:var Q=Tn({},e.dirtyFlagsCollection);return t.guids.forEach(function(e){delete Q[e]}),Tn({},e,{dirtyFlagsCollection:Q,nextNotesDiff:{}});default:return e}}},{key:"Actions",get:function(){var e=this;return{updateNotes:function(t,n,r){var o=n||new dt.NoteResultSpec;if(null==r){var i=new Error("locator was unexpectedly null in updateNotes");throw Cn.error(i),i}var u=o.includeContent?t.map(function(e){return Tn({},e,{_marshalledResources:Object(yt.createResourceMap)(e,r)})}):t,a=e.getState().notes,c=u.filter(function(e){return((a[e.guid]||{}).updateSequenceNum||0)<=(e.updateSequenceNum||0)});e.dispatch({type:In.UPDATE_NOTES,notes:c,resultSpec:o})},expungeNotes:function(t){e.dispatch({type:In.EXPUNGE_NOTES,guids:t})},expungeNotesSelectively:function(t,n){e.dispatch({type:In.EXPUNGE_NOTES,guids:t,predicate:n})},selectNote:function(t,n){e.dispatch({type:In.SELECT_NOTE,guid:t,windowId:n})},updateLock:function(t,n){e.dispatch({type:In.UPDATE_LOCK,guid:t,lockState:n})}}}},{key:"Utils",get:function(){return{getInitialLockState:function(){return{hasLock:!1,isAcquiringLock:!1,isLockAvailable:!1}}}}}]),t}()),Ln=xn;function Fn(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function Kn(e){return(Kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Mn(e,t,n[t])})}return e}function Mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vn(e,t){return!t||"object"!==Kn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Hn(e){return(Hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zn(e,t,n){return t&&Wn(e.prototype,t),n&&Wn(e,n),e}function Yn(e,t){return(Yn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("note.datasource.getnote",function(e){return new Promise(function(t,n){xn.dataSourceInitialized.then(function(){var n=xn.getState().notes[e]||null;t(n)}).catch(function(e){n(e)})})}),i.a.register("note.datasource.getselectedguids",On(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xn.dataSourceInitialized;case 2:return e.abrupt("return",Je.a.uniq(Object.values(xn.getState().selectedNotes||{})));case 3:case"end":return e.stop()}},e,this)}))),i.a.register("note.actions.getall",function(){return new Promise(function(e){xn.dataSourceInitialized.then(function(){e(xn.getState().notes)})})}),i.a.register("note.actions.getdirty",On(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xn.dataSourceInitialized;case 2:return t=xn.getState(),e.abrupt("return",Ot(t.notes,t.dirtyFlagsCollection));case 4:case"end":return e.stop()}},e,this)}))),i.a.register("note.actions.cleardirty",function(){var e=On(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xn.dataSourceInitialized;case 2:xn.dispatch({type:In.CLEAR_DIRTY,guids:t});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),i.a.register("note.actions.expungeNotesLocal",function(){var e=On(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,xn.dataSourceInitialized;case 2:xn.dispatch({type:In.DELETE_LOCAL,guids:t}),i.a.publish("sync.notes");case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var qn,Xn="SUGAR/PREFERENCE_DATASOURCE";!function(e){e.UPDATE_PREFERENCES="SUGAR/PREFERENCES/UPDATE_PREFERENCES",e.UPDATE_SHORTCUT_EXPANSION="SUGAR/PREFERENCES/UPDATE_SHORTCUT_EXPANSION"}(qn||(qn={}));var Qn={shortcuts:{shortcutsArray:[],expanded:!1}},Jn=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Vn(this,Hn(t).call(this,Qn,"preference",Xn,!0))).subscribe=function(){var t=i.a.subscribe("preference",function(t){switch(t.type){case"updatePreferences":return e.Actions.updatePreferences(t.data);case"updateShortcutsExpanded":return e.Actions.updateShortcutsExpanded(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Yn(e,t)}(t,b),zn(t,[{key:"initialState",get:function(){return Qn}},{key:"Constants",get:function(){return qn}}]),zn(t,[{key:"mapInternalToExternalState",value:function(e){return this.Utils.parsePreferenceShortcuts(e.shortcuts)}},{key:"reducer",value:function(e,t){switch(t.type){case qn.UPDATE_PREFERENCES:return Bn({},e,{shortcuts:Bn({},e.shortcuts,{shortcutsArray:t.preferences["evernote.shortcuts"]||[]})});case qn.UPDATE_SHORTCUT_EXPANSION:return Bn({},e,{shortcuts:Bn({},e.shortcuts,{expanded:t.expanded})});default:return e}}},{key:"Actions",get:function(){var e=this;return{updatePreferences:function(t){e.dispatch({type:qn.UPDATE_PREFERENCES,preferences:t.preferences||{}})},updateShortcutsExpanded:function(t){e.dispatch({type:qn.UPDATE_SHORTCUT_EXPANSION,expanded:t})}}}},{key:"Utils",get:function(){var e=this;return{parsePreferenceShortcuts:function(t){var n=t.shortcutsArray;if(0===n.length)return{shortcuts:{updated:null,shortcuts:[],expanded:e.Utils.getExpanded()}};var r=JSON.parse(n[0]).updated,o=[];return Je.a.forEach(n.slice(1),function(e){var t=JSON.parse(e),n=t[0];switch(n){case"Note":o.push({type:n,noteGuid:t[1]});break;case"Notebook":o.push({type:n,notebookGuid:t[1]});break;case"Stack":o.push({type:n,stackName:t[1]})}}),{shortcuts:{updated:r,shortcuts:o,expanded:e.Utils.getExpanded()}}},getExpanded:function(){return e.state.shortcuts.expanded||!1}}}}]),t}()),Zn=Jn;function $n(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function er(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){$n(i,r,o,u,a,"next",e)}function a(e){$n(i,r,o,u,a,"throw",e)}u(void 0)})}}function tr(e){return(tr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function nr(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function rr(e){var t=function(e,t){if("object"!==tr(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==tr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===tr(t)?t:String(t)}function or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ir(e,t,n[t])})}return e}function ir(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ur(e,t){return!t||"object"!==tr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ar(e){return(ar=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sr(e,t,n){return t&&cr(e.prototype,t),n&&cr(e,n),e}function fr(e,t){return(fr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("preference.actions.getshortcutsarray",function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){Fn(i,r,o,u,a,"next",e)}function a(e){Fn(i,r,o,u,a,"throw",e)}u(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.dataSourceInitialized;case 2:return e.abrupt("return",Jn.getState().shortcuts.shortcutsArray);case 3:case"end":return e.stop()}},e,this)})));var lr,pr="SUGAR/PROFILE_DATASOURCE";!function(e){e.SET_PROFILES="SUGAR/PROFILES/SET_PROFILES",e.SET_USERS_UPDATE_COUNT="SUGAR/PROFILES/SET_USERS_UPDATE_COUNT",e.USER_TO_PROFILE="SUGAR/PROFILES/USER_TO_PROFILE"}(lr||(lr={}));var dr={businessUsersUpdateCount:-1,profiles:{}},br=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ur(this,ar(t).call(this,dr,"profile",pr,!0))).subscribe=function(){var t=i.a.subscribe("profile",function(t){switch(t.type){case"set":return e.Actions.set(t.data);case"setbusinessusersupdatecount":return e.Actions.setBusinessUsersUpdateCount(t.data)}}),n=i.a.subscribe("user",function(t){switch(t.type){case"update":return e.Actions.userToProfile(t.data)}});e.unsubscribeFns=[t,n]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fr(e,t)}(t,b),sr(t,[{key:"initialState",get:function(){return dr}},{key:"Constants",get:function(){return lr}}]),sr(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case lr.SET_USERS_UPDATE_COUNT:return or({},e,{businessUsersUpdateCount:t.businessUsersUpdateCount});case lr.SET_PROFILES:return or({},e,{profiles:or({},t.profiles)});case lr.USER_TO_PROFILE:var n=t.user.id;if(null==n)return e;var r=e.profiles,o=r[n],i=nr(r,[n].map(rr)),u=nr(e,["profiles"]),a=new Ge.UserProfile(o);return a.id=n,a.name=t.user.name||t.user.email,a.email=t.user.email,a.username=t.user.username,a.photoLastUpdated=t.user.photoLastUpdated,a.photoUrl=t.user.photoUrl,or({},u,{profiles:or({},i,ir({},n,a))});default:return e}}},{key:"Actions",get:function(){var e=this;return{set:function(t){e.dispatch({type:lr.SET_PROFILES,profiles:t})},userToProfile:function(t){e.dispatch({type:lr.USER_TO_PROFILE,user:t})},setBusinessUsersUpdateCount:function(t){e.dispatch({type:lr.SET_USERS_UPDATE_COUNT,businessUsersUpdateCount:t})}}}},{key:"Utils",get:function(){return{}}}]),t}()),yr=br;function hr(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function gr(e){return(gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function mr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){vr(e,t,n[t])})}return e}function vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sr(e,t){return!t||"object"!==gr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Or(e){return(Or=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Er(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function kr(e,t,n){return t&&Er(e.prototype,t),n&&Er(e,n),e}function Tr(e,t){return(Tr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("profile.actions.getprofiles",er(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,br.dataSourceInitialized;case 2:return e.abrupt("return",br.getState().profiles);case 3:case"end":return e.stop()}},e,this)}))),i.a.register("profile.actions.getbusinessusersupdatecount",er(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,br.dataSourceInitialized;case 2:return e.abrupt("return",br.getState().businessUsersUpdateCount);case 3:case"end":return e.stop()}},e,this)})));var wr,Ar=Object(u.default)("ion:sugar:Promotion");!function(e){e.UPDATE_PROMOTIONS="SUGAR/PROMOTION/UPDATE_PROMOTIONS",e.UPDATE_CROSS_PROMOTIONS="SUGAR/PROMOTION/UPDATE_CROSS_PROMOTIONS",e.DELETE_PROMOTIONS="SUGAR/PROMOTION/DELETE_PROMOTIONS"}(wr||(wr={}));var _r="SUGAR/PROMOTION_DATASOURCE",Pr={promotions:{},crossPromotionInfo:null},Rr=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Sr(this,Or(t).call(this,Pr,"promotion",_r,!0))).Constants=wr,e.subscribe=function(){var t=i.a.subscribe("promotion",function(t){switch(Ar.log("Promotion Status subscriber ",t),t.type){case"updatePromotion":return e.Actions.updatePromotions([t.data]);case"updatePromotions":return e.Actions.updatePromotions(t.data);case"updateCrossPromotions":return e.Actions.updateCrossPromotions(t.data);case"deletePromotion":return e.Actions.deletePromotions([t.data]);case"deletePromotions":return e.Actions.deletePromotions(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tr(e,t)}(t,b),kr(t,[{key:"initialState",get:function(){return Pr}}]),kr(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case wr.UPDATE_PROMOTIONS:return mr({},e,{promotions:t.promotions.reduce(function(e,t){var n=t.promotionId;if(null==n)return e;var r=mr({},e[n]||{},t);return e[n]=r,e},mr({},e.promotions))});case wr.UPDATE_CROSS_PROMOTIONS:return mr({},e,{crossPromotionInfo:t.crossPromotionInfo});case wr.DELETE_PROMOTIONS:var n=t.promotionIds,r=mr({},e),o=r.promotions;return n.reduce(function(e,t){return delete e[t],e},o),r;default:return e}}},{key:"Actions",get:function(){var e=this;return{updatePromotions:function(t){e.dispatch({type:wr.UPDATE_PROMOTIONS,promotions:t})},updateCrossPromotions:function(t){e.dispatch({type:wr.UPDATE_CROSS_PROMOTIONS,crossPromotionInfo:t})},deletePromotions:function(t){e.dispatch({type:wr.DELETE_PROMOTIONS,promotionIds:t})}}}}]),t}()),Nr=Rr;function Ur(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function Ir(e){return(Ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Cr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gr(e,t){return!t||"object"!==Ir(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function jr(e){return(jr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Dr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xr(e,t,n){return t&&Dr(e.prototype,t),n&&Dr(e,n),e}function Lr(e,t){return(Lr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("promotion.actions.getCrossPromotionInfo",function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){hr(i,r,o,u,a,"next",e)}function a(e){hr(i,r,o,u,a,"throw",e)}u(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rr.dataSourceInitialized;case 2:return e.abrupt("return",Rr.getState().crossPromotionInfo||null);case 3:case"end":return e.stop()}},e,this)})));var Fr,Kr="SUGAR/QUICK_SWITCHER_DATASOURCE";(Fr||(Fr={})).SET_RECENT_QUERIES="SUGAR/QUICK_SWITCHER/SET_RECENT_QUERIES";var Br={recentQueries:[]},Mr=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Gr(this,jr(t).call(this,Br,"quickswitcher",Kr,!0))).subscribe=function(){var t=i.a.subscribe("quickswitcher",function(t){switch(t.type){case"set":return e.Actions.setRecentQueries(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lr(e,t)}(t,b),xr(t,[{key:"initialState",get:function(){return Br}},{key:"Constants",get:function(){return Fr}}]),xr(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Fr.SET_RECENT_QUERIES:return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Cr(e,t,n[t])})}return e}({},e,{recentQueries:t.recentQueries});default:return e}}},{key:"Actions",get:function(){var e=this;return{getRecentQueries:function(){return e.getState().recentQueries},setRecentQueries:function(t){e.dispatch({type:Fr.SET_RECENT_QUERIES,recentQueries:t})}}}}]),t}()),Vr=Mr;function Hr(e){return(Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wr(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function zr(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Yr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){qr(e,t,n[t])})}return e}function qr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xr(e,t){return!t||"object"!==Hr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qr(e){return(Qr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zr(e,t,n){return t&&Jr(e.prototype,t),n&&Jr(e,n),e}function $r(e,t){return($r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("quickswitcher.actions.getrecentqueries",function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){Ur(i,r,o,u,a,"next",e)}function a(e){Ur(i,r,o,u,a,"throw",e)}u(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Mr.Actions.getRecentQueries());case 1:case"end":return e.stop()}},e,this)}))),i.a.register("quickswitcher.actions.setrecentqueries",function(e){return Mr.Actions.setRecentQueries(e),Promise.resolve()});var eo="SUGAR/SEARCH_DATASOURCE",to={EXECUTE_SEARCH_SERVICE:"SUGAR/SEARCH/EXECUTE_SEARCH_SERVICE"},no={results:null},ro=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Xr(this,Qr(t).call(this,no,"search",eo,!0))).Constants=to,e.subscribe=function(){var t=i.a.subscribe("search",function(t){switch(t.type){case"findnotes":return e.Actions.findNotes(t.data.filter,t.data.errCb)}}),n=i.a.subscribe("service.search",function(t){switch(t.type){case"fillresults":return e.Actions.fillWithResults(t.data)}});e.unsubscribeFns=[t,n]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$r(e,t)}(t,b),Zr(t,[{key:"initialState",get:function(){return no}}]),Zr(t,[{key:"mapInternalToExternalState",value:function(e){return e.results}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case to.EXECUTE_SEARCH_SERVICE:if(null==t.results.startIndex||null==t.results.notes||null==e.results||null==e.results.notes||!Je.a.isEqual(e.results.searchedWords,t.results.searchedWords)||!Je.a.isEqual(e.results.stoppedWords,t.results.stoppedWords))return Yr({},e,{results:t.results});var n=t.results.startIndex,r=t.results.notes,o=Je.a.cloneDeep(e.results.notes||[]);return o.splice.apply(o,[n,r.length].concat(zr(r))),0===o.length?Yr({},e,{results:t.results}):Yr({},e,{results:Yr({},t.results,{notes:o})});default:return e}}},{key:"Actions",get:function(){var e=this;return{findNotes:function(t,n){e.dataSourceReady.then(function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){Wr(i,r,o,u,a,"next",e)}function a(e){Wr(i,r,o,u,a,"throw",e)}u(void 0)})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i.a.call("note.actions.findNotesMetadata",{filter:t});case 1:case"end":return e.stop()}},e,this)}))).catch(n())},fillWithResults:function(t){e.dispatch({type:to.EXECUTE_SEARCH_SERVICE,results:t})}}}},{key:"Utils",get:function(){return{validateName:mt.a.validationWithoutUnique.name}}}]),t}());function oo(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function io(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){oo(i,r,o,u,a,"next",e)}function a(e){oo(i,r,o,u,a,"throw",e)}u(void 0)})}}function uo(e){return(uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ao(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){co(e,t,n[t])})}return e}function co(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function so(e,t){return!t||"object"!==uo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fo(e){return(fo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function lo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function po(e,t,n){return t&&lo(e.prototype,t),n&&lo(e,n),e}function bo(e,t){return(bo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var yo,ho=Object(u.default)("ion:sugar:survey");(yo||(yo={})).SET_QUALTRICS_PROMOTIONS="SUGAR/SURVEY/SET_QUALTRICS_PROMOTIONS";var go="SUGAR/SURVEY_DATASOURCE",mo={qualtricsPromotions:{}},vo=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=so(this,fo(t).call(this,mo,"survey",go,!0))).subscribe=function(){var t=i.a.subscribe("survey",function(t){switch(ho.log("Qualtrics subscribe",t),t.type){case"setQualtricsPromotions":return e.Actions.setQualtricsPromotions(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bo(e,t)}(t,b),po(t,[{key:"initialState",get:function(){return mo}},{key:"Constants",get:function(){return yo}}]),po(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case yo.SET_QUALTRICS_PROMOTIONS:var n=t.surveys;return ao({},e,{qualtricsPromotions:ao({},e.qualtricsPromotions,n)});default:return e}}},{key:"Actions",get:function(){var e=this;return{setQualtricsPromotions:function(t){e.dispatch({type:yo.SET_QUALTRICS_PROMOTIONS,surveys:t})}}}}]),t}()),So=vo;i.a.register("survey.actions.hasPromotions",io(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!Je.a.isEmpty(vo.getState().qualtricsPromotions));case 1:case"end":return e.stop()}},e,this)}))),i.a.register("survey.actions.getQualtricsPromotions",io(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vo.getState().qualtricsPromotions);case 1:case"end":return e.stop()}},e,this)})));var Oo=n(471);function Eo(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function ko(e){return(ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function To(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){wo(e,t,n[t])})}return e}function wo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ao(e,t){return!t||"object"!==ko(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _o(e){return(_o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Po(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ro(e,t,n){return t&&Po(e.prototype,t),n&&Po(e,n),e}function No(e,t){return(No=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Uo,Io=Object(u.default)("ion:sugar:Task"),Co="SUGAR/TASK_DATASOURCE";!function(e){e.EXPUNGE_TASKS="SUGAR/TASK/EXPUNGE_TASKS",e.UPDATE_TASKS="SUGAR/TASK/UPDATE_TASKS",e.SET_TASK_GROUP="SUGAR/TASK/SET_TASK_GROUP",e.SET_TASK_VIEW="SUGAR/TASK/SET_TASK_VIEW"}(Uo||(Uo={}));var Go={tasks:{},taskGroup:Oo.TASK_GROUP.NONE,taskView:Oo.TASK_VIEW.MY_TASKS},jo=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Ao(this,_o(t).call(this,Go,"task",Co,!0))).subscribe=function(){var t=i.a.subscribe("task",function(t){switch(Io.log("Task subscriber ",t),t.type){case"updateTask":return e.Actions.updateTasks([t.data]);case"updateTasks":return e.Actions.updateTasks(t.data);case"expungeTask":return e.Actions.expungeTasks([t.data]);case"expungeTasks":return e.Actions.expungeTasks(t.data);case"setGroup":return e.Actions.setGroup(t.data);case"setView":return e.Actions.setView(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&No(e,t)}(t,b),Ro(t,[{key:"initialState",get:function(){return Go}},{key:"Constants",get:function(){return Uo}}]),Ro(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case Uo.UPDATE_TASKS:var n=t.tasks,r=To({},e.tasks);return n.reduce(function(e,t){var n=t.guid;if(null==n)return e;var r=To({},e[n]||{},t);return e[n]=r,e},r),To({},e,{tasks:r});case Uo.EXPUNGE_TASKS:var o=t.guids,i=To({},e.tasks);return o.reduce(function(e,t){return delete e[t],e},i),To({},e,{tasks:i});case Uo.SET_TASK_GROUP:return To({},e,{taskGroup:t.taskGroup});case Uo.SET_TASK_VIEW:return To({},e,{taskView:t.taskView});default:return e}}},{key:"Actions",get:function(){var e=this;return{updateTasks:function(t){e.dispatch({type:Uo.UPDATE_TASKS,tasks:t})},expungeTasks:function(t){e.dispatch({type:Uo.EXPUNGE_TASKS,guids:t})},setGroup:function(t){e.dispatch({type:Uo.SET_TASK_GROUP,taskGroup:t})},setView:function(t){e.dispatch({type:Uo.SET_TASK_VIEW,taskView:t})}}}}]),t}()),Do=jo;i.a.register("task.datasource.getTask",function(){var e=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){Eo(i,r,o,u,a,"next",e)}function a(e){Eo(i,r,o,u,a,"throw",e)}u(void 0)})}}(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",jo.getState().tasks[t]);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var xo,Lo=n(378),Fo=n(460),Ko=(n(58),function(e,t){return Je.a.find(e.sharedNotebooks,["recipientUserId",t])});function Bo(e){return(Bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mo(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Vo(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function Ho(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){Vo(i,r,o,u,a,"next",e)}function a(e){Vo(i,r,o,u,a,"throw",e)}u(void 0)})}}function Wo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){zo(e,t,n[t])})}return e}function zo(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yo(e,t){return!t||"object"!==Bo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qo(e){return(qo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Xo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qo(e,t,n){return t&&Xo(e.prototype,t),n&&Xo(e,n),e}function Jo(e,t){return(Jo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}(xo||(xo={})).UPDATE_THREADS_FROM_SERVICE="SUGAR/THREADS/UPDATE_THREADS_FROM_SERVICE";var Zo="SUGAR/THREADS_DATASOURCE",$o={threads:{}},ei=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=Yo(this,qo(t).call(this,$o,"threads",Zo,!0))).subscribe=function(){var t=i.a.subscribe("service.threads",function(t){switch(t.type){case"update":e.ServiceActions.update(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jo(e,t)}(t,b),Qo(t,[{key:"initialState",get:function(){return $o}},{key:"Constants",get:function(){return xo}}]),Qo(t,[{key:"mapInternalToExternalState",value:function(e){return Wo({},e.threads)}},{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case xo.UPDATE_THREADS_FROM_SERVICE:return{threads:Wo({},e.threads,t.threads)};default:return e}}},{key:"Actions",get:function(){var e=this;return{getThreadForParticipants:function(){var t=Ho(regeneratorRuntime.mark(function t(n){var r,o,u,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.call("identity.actions.getidentitiesforusers",n);case 2:if(r=t.sent,o=[],u=!1,r.forEach(function(e){e.id||(u=!0),o.push(e.id)}),!u){t.next=8;break}return t.abrupt("return",null);case 8:return a=null,Object.keys(e.state.threads).forEach(function(t){var n=e.state.threads[t];if(n&&n.participantIds){var r=n.participantIds,i=!1;o.forEach(function(e){-1===r.indexOf(e)&&(i=!0)});var u=!1;r.forEach(function(e){-1===o.indexOf(e)&&(u=!0)}),i||u||(a=n)}}),t.abrupt("return",a);case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),createMessageThread:function(){var e=Ho(regeneratorRuntime.mark(function e(t,n){var r,o,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,i.a.call("identity.actions.getidentitiesforusers",t);case 3:return r=e.sent,o=[],t.forEach(function(e){for(var t=!1,n=0;n<r.length;n++){var i=r[n],u="number"==typeof e&&i.userId===e||"string"==typeof e&&i.contact&&i.contact.id===e;if(i.contact&&u){t=!0,o.push(i.contact);break}}t||o.push({type:Ge.ContactType.EVERNOTE,id:String(e)})}),u=new Fo.CreateMessageThreadSpec({message:n,participants:o,groupThread:o.length>2}),e.next=9,i.a.call("workchat.actions.createMessageThread",{threadSpec:u});case 9:i.a.publish("sync.actions.syncworkchat"),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(0),e.t0;case 15:case"end":return e.stop()}},e,this,[[0,12]])}));return function(t,n){return e.apply(this,arguments)}}(),sendMessage:function(){var t=Ho(regeneratorRuntime.mark(function t(n,r,o,u){var a,c,s,f,l,p,d,b,y,h,g,m,v;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,i.a.call("user.actions.getactiveuser");case 3:if((a=t.sent)&&a.id){t.next=6;break}throw new Error("#sendMessage: no user provided");case 6:if(!(c=Object(Lo.d)())){t.next=13;break}return t.next=10,i.a.call("user.actions.getvaultuserid");case 10:t.t0=t.sent,t.next=14;break;case 13:t.t0=a.id;case 14:if(s=t.t0,!c){t.next=21;break}return t.next=18,i.a.call("business.getshard");case 18:t.t1=t.sent,t.next=22;break;case 21:t.t1=a.shardId;case 22:return f=t.t1,(l=Mo(n)).push(a.id||0),l=Je.a.uniq(l),t.next=28,e.Actions.getThreadForParticipants(l);case 28:if(p=t.sent,d=function(t,n,a,c){var d=new Fo.MessageAttachment({type:t,title:a,guid:o.guid,shardId:u?n:f,userId:u?c:s}),b=new Fo.Message({body:r,attachments:[d]});return p?(b.messageThreadId=p.id,i.a.call("workchat.actions.sendMessageToThread",{message:b})):e.Actions.createMessageThread(l,b)},!o){t.next=48;break}if(y=a.shardId,h=a.id,!o.notebookGuid){t.next=40;break}return b=Fo.MessageAttachmentType.NOTE,t.next=37,i.a.call("attachments.actions.getattachment",o.guid);case 37:return(g=t.sent)&&(y=g.shardId,h=g.senderId),t.abrupt("return",d(b,y,o.title,h));case 40:return b=Fo.MessageAttachmentType.NOTEBOOK,t.next=43,i.a.call("linkednotebook.actions.getlinkednotebook",o.guid);case 43:return m=t.sent,v=Ko(o,h),m&&(y=m.shardId),v&&(h=v.sharerUserId),t.abrupt("return",d(b,y,o.name,h));case 48:t.next=53;break;case 50:throw t.prev=50,t.t2=t.catch(0),t.t2;case 53:case"end":return t.stop()}},t,this,[[0,50]])}));return function(e,n,r,o){return t.apply(this,arguments)}}()}}},{key:"ServiceActions",get:function(){var e=this;return{update:function(t){if(t){var n={};t.forEach(function(e){var t=e.messageThread,r=e.lastReadMessageId;n[t.id]=Wo({},t,{lastReadMessageId:r||null})}),e.dispatch({type:xo.UPDATE_THREADS_FROM_SERVICE,threads:n})}}}}}]),t}()),ti=ei;function ni(e){return(ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ri(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function oi(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){ri(i,r,o,u,a,"next",e)}function a(e){ri(i,r,o,u,a,"throw",e)}u(void 0)})}}function ii(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){ui(e,t,n[t])})}return e}function ui(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ai(e,t){return!t||"object"!==ni(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ci(e){return(ci=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function si(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function fi(e,t,n){return t&&si(e.prototype,t),n&&si(e,n),e}function li(e,t){return(li=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}i.a.register("threads.actions.sendmessage",function(){var e=Ho(regeneratorRuntime.mark(function e(t){var n,r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.userIds,r=t.message,o=t.attachment,i=t.isExternal,e.next=3,ei.Actions.sendMessage(n,r,o,i);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var pi="SUGAR/USER_DATASOURCE",di={UPDATE_SYNC_STATE:"SUGAR/USERS/UPDATE_SYNC_STATE",UPDATE_USER:"SUGAR/USERS/UPDATE_USER",UPDATE_VAULT_USER:"SUGAR/USERS/UPDATE_VAULT_USER",UPDATE_BUSINESS_SHARD:"SUGAR/USERS/UPDATE_BUSINESS_SHARD",UPDATE_USER_LAST_UPDATED:"SUGAR/USERS/UPDATE_USER_LAST_UPDATED"},bi={user:null,vaultUser:null,vaultUserId:null,businessShardId:null,userLastUpdated:0},yi=new(function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=ai(this,ci(t).call(this,bi,"user",pi,!0))).subscribe=function(){var t=i.a.subscribe("user",function(t){switch(t.type){case"update":return e.Actions.update(t.data);case"setvaultuser":return e.Actions.updateVaultUser(t.data);case"setbusinessshard":return e.Actions.updateBusinessShard(t.data);case"setUserLastUpdated":return e.Actions.updateUserLastUpdated(t.data)}});e.unsubscribeFns=[t]},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&li(e,t)}(t,b),fi(t,[{key:"initialState",get:function(){return bi}},{key:"Constants",get:function(){return di}}]),fi(t,[{key:"reducer",value:function(e,t){switch(Object.freeze(e),t.type){case di.UPDATE_USER:return ii({},e,{user:t.user});case di.UPDATE_VAULT_USER:return ii({},e,{vaultUserId:Je.a.isEmpty(t.vaultUser)?bi.vaultUserId:t.vaultUser.id,vaultUser:t.vaultUser});case di.UPDATE_BUSINESS_SHARD:return ii({},e,{businessShardId:t.businessShardId});case di.UPDATE_USER_LAST_UPDATED:return ii({},e,{userLastUpdated:t.userLastUpdated});default:return e}}},{key:"Actions",get:function(){var e=this;return{getActiveUser:function(){var t=oi(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getState().user);case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getActiveUserId:function(){var t=oi(regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.getState(),null!=(r=n.user)){t.next=3;break}return t.abrupt("return",null);case 3:return t.abrupt("return",r.id);case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getVaultUser:function(){var t=oi(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.getState().vaultUserId);case 1:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),update:function(t){e.dispatch({type:di.UPDATE_USER,user:t})},updateVaultUser:function(t){e.dispatch({type:di.UPDATE_VAULT_USER,vaultUser:t})},updateBusinessShard:function(t){e.dispatch({type:di.UPDATE_BUSINESS_SHARD,businessShardId:t})},updateUserLastUpdated:function(t){e.dispatch({type:di.UPDATE_USER_LAST_UPDATED,userLastUpdated:t})}}}}]),t}()),hi=yi;function gi(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}i.a.register("user.actions.getactiveuser",oi(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yi.dataSourceInitialized;case 2:return e.abrupt("return",yi.Actions.getActiveUser());case 3:case"end":return e.stop()}},e,this)}))),i.a.register("user.actions.getactiveuserid",oi(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yi.dataSourceInitialized;case 2:return e.abrupt("return",yi.Actions.getActiveUserId());case 3:case"end":return e.stop()}},e,this)}))),i.a.register("user.actions.getvaultuserid",oi(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yi.dataSourceInitialized;case 2:return e.abrupt("return",yi.Actions.getVaultUser());case 3:case"end":return e.stop()}},e,this)}))),i.a.register("user.actions.getUserLastUpdated",oi(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yi.dataSourceInitialized;case 2:return e.abrupt("return",yi.getState().userLastUpdated||0);case 3:case"end":return e.stop()}},e,this)}))),n.d(t,"clearTables",function(){return ki}),n.d(t,"logDataSources",function(){return Ti}),n.d(t,"logCompressedDataSources",function(){return wi}),n.d(t,"Attachments",function(){return N}),n.d(t,"CommEngine",function(){return V}),n.d(t,"Config",function(){return re}),n.d(t,"Flow",function(){return ge}),n.d(t,"HVA",function(){return Ie}),n.d(t,"Identity",function(){return qe}),n.d(t,"LinkedNotebook",function(){return pt}),n.d(t,"Note",function(){return Ln}),n.d(t,"Notebook",function(){return nn}),n.d(t,"Preference",function(){return Zn}),n.d(t,"Profile",function(){return yr}),n.d(t,"QuickSwitcher",function(){return Vr}),n.d(t,"Survey",function(){return So}),n.d(t,"Tag",function(){return vn}),n.d(t,"Task",function(){return Do}),n.d(t,"Threads",function(){return ti}),n.d(t,"User",function(){return hi}),n.d(t,"Workspace",function(){return Ft});var mi,vi,Si=Object(u.default)("ion:sugar"),Oi={Attachments:N,CommEngine:V,Config:re,Flow:ge,HVA:Ie,Identity:qe,LinkedNotebook:pt,Note:Ln,Notebook:nn,Preference:Zn,Profile:yr,Promotion:Nr,QuickSwitcher:Vr,Search:ro,Survey:So,Tag:vn,Task:Do,Threads:ti,User:hi,Workspace:Ft};t.default=Oi;function Ei(){return(Ei=function(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){gi(i,r,o,u,a,"next",e)}function a(e){gi(i,r,o,u,a,"throw",e)}u(void 0)})}}(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!vi){e.next=5;break}return b.reset(),t=b.getInstances().map(function(e){return e.deInit()}),e.next=5,Promise.all(t);case 5:mi="",vi=null;case 7:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function ki(){b.getInstances().forEach(function(e){e.deleteState(mi)})}function Ti(){Si.log("DataSource getInstances returns",b.getInstances())}function wi(){var e={};b.getInstances().forEach(function(t){r.default.get(Object(o.a)(t.namespace),t.tableName).then(function(n){for(var r={},o=Object.keys(n),i=0;i<o.length;i++){var u=o[i];Array.isArray(n[u])?r[u]=n[u].length:r[u]=Object.keys(n[u]).length}e["".concat(t.namespace,"_").concat(t.tableName)]=r})}),Si.log("logCompressedDataSources returns",JSON.stringify(e))}i.a.register("sugar.init",function(e){return vi?String(e)!==mi?Promise.reject():vi:vi=new Promise(function(t){mi=String(e);var n=b.getInstances().map(function(e){return e.init(mi)});Promise.all(n).then(function(){return t()})})}),i.a.register("sugar.deinit",function(){return Ei.apply(this,arguments)})},66:function(e,t,n){"use strict";n.r(t);var r=n(30),o=n(61),i=n(22);function u(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,c,"next",e)}function c(e){u(i,r,o,a,c,"throw",e)}a(void 0)})}}var c=Object(i.default)("ion:cupboard:migration"),s=[],f=function(){var e=a(regeneratorRuntime.mark(function e(t,n,r){var o,i,u,f,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){var e=o(t),r=o(n);if(-1===r)throw new Error("No migration object found for target version ".concat(n));if(e>r)throw new Error("Downgrade operation is not supported. ".concat(t," ").concat(n));if(e!==r)return u(i(e,r));c.warn("Migration path called for same current and target versions ".concat(t," ").concat(n))},f=function(){return(f=a(regeneratorRuntime.mark(function e(o){var i,u,a,s,f,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c.info("Starting cupboard upgrade from ".concat(t," to ").concat(n)),i=!0,u=!1,a=void 0,e.prev=4,s=o[Symbol.iterator]();case 6:if(i=(f=s.next()).done){e.next=13;break}return l=f.value,e.next=10,l.upgradeFn(r);case 10:i=!0,e.next=6;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(4),u=!0,a=e.t0;case 19:e.prev=19,e.prev=20,i||null==s.return||s.return();case 22:if(e.prev=22,!u){e.next=25;break}throw a;case 25:return e.finish(22);case 26:return e.finish(19);case 27:c.info("Finished cupboard upgrade from ".concat(t," to ").concat(n));case 28:case"end":return e.stop()}},e,this,[[4,15,19,27],[20,,22,26]])}))).apply(this,arguments)},u=function(e){return f.apply(this,arguments)},i=function(e,t){return s.slice(e+1,t+1)},o=function(e){return s.findIndex(function(t){return t.key===e})},e.abrupt("return",l());case 6:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}(),l={key:"ION_8816",upgradeFn:b},p={key:"ION_8838",upgradeFn:b},d={key:"ION_8489",upgradeFn:b};function b(e){return o.a.call("cupboard.clearNamespace",{namespace:e})}s.push(l),s.push(p),s.push(d);var y=f,h=n(43),g=n.n(h);function m(e,t,n,r,o,i,u){try{var a=e[i](u),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function v(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function u(e){m(i,r,o,u,a,"next",e)}function a(e){m(i,r,o,u,a,"throw",e)}u(void 0)})}}var S=Object(i.default)("ion:cupboard"),O=Object(r.b)().objectPersistence,E=function(e,t){return null==e?t:"".concat(e,"_").concat(t)},k={clear:function(){return new Promise(function(e){O.clear().then(function(){return e()}).catch(S.error)})},clearNamespace:function(){var e=v(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.keys();case 2:return n=e.sent,r=n.filter(function(e){return e.startsWith(t)}),e.next=6,Promise.all(r.map(function(e){return O.removeItem(e)}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),get:function(e,t){return new Promise(function(n){var r=E(e,t);O.getItem(r).then(function(e){return n(e)}).catch(function(e){return S.error(e)})})},set:function(){var e=v(regeneratorRuntime.mark(function e(t,n,r){var o,i,u=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=u.length>3&&void 0!==u[3]&&u[3],e.next=3,this.get(null,"SCHEMA_VERSION");case 3:if(i=e.sent,o||i===g.a.SCHEMA_VERSION){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,O.setItem(E(t,n),r);case 8:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}(),migrate:function(){var e=v(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(null,"SCHEMA_VERSION");case 2:if(n=e.sent,e.prev=3,!n||n===g.a.SCHEMA_VERSION){e.next=7;break}return e.next=7,y(n,g.a.SCHEMA_VERSION,t);case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(3),S.error("Failed to migrate to version ".concat(g.a.SCHEMA_VERSION," from ").concat(n," error ").concat(JSON.stringify(e.t0),". Clearing cupboard.")),e.next=14,this.clear();case 14:return e.prev=14,e.next=17,O.setItem("SCHEMA_VERSION",g.a.SCHEMA_VERSION);case 17:return e.finish(14);case 18:case"end":return e.stop()}},e,this,[[3,9,14,18]])}));return function(t){return e.apply(this,arguments)}}()};o.a.register("cupboard.get",function(e){var t=e.namespace,n=e.key;return k.get(t,n)}),o.a.register("cupboard.set",function(e){var t=e.namespace,n=e.key,r=e.value,o=e.forceWrite;return k.set(t,n,r,o)}),o.a.register("cupboard.clear",function(){return k.clear()}),o.a.register("cupboard.clearNamespace",function(e){var t=e.namespace;return k.clearNamespace(t)}),o.a.register("cupboard.migrate",function(e){var t=e.namespace;return k.migrate(t)});t.default=k}}]);